version: "3.9"

services:
  bridge_gateway:
    image: marshalleriksen/mcpproxy-gateway:${IMAGE_TAG:-latest}
    restart: unless-stopped
    env_file:
      - .env
    # 说明：
    # - Agent 连接的是 WebSocket：ws(s)://<host>:8088/bridge/tunnel
    # - 后端通过内网 HTTP 调用：BRIDGE_GATEWAY_URL=http://bridge_gateway:8088
    # - 若对公网暴露 8088，强烈建议设置 BRIDGE_GATEWAY_INTERNAL_TOKEN 以保护 /internal/bridge/* 接口
    ports:
      - "127.0.0.1:8088:8088"
    command:
      [
        "gateway",
        "serve",
        "--listen",
        ":8088",
        "--tunnel-path",
        "/bridge/tunnel",
        "--agent-token-secret",
        "${SECRET_KEY}",
        "--internal-token",
        "${BRIDGE_GATEWAY_INTERNAL_TOKEN}",
      ]
